<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 6296bis IPv6-to-IPv6 Network Prefix Translation</title>
<meta content="Margaret Wasserman" name="author">
<meta content="Fred Baker" name="author">
<meta content="Ole Troan" name="author">
<meta content="Nick Buraglio" name="author">
<meta content='
       This document describes a stateless, transport-agnostic IPv6-to-IPv6
Network Prefix Translation (NPTv6) function that provides the
address-independence benefit associated with IPv4-to-IPv4 NAT
(NAPT44) and provides a 1:1 relationship between addresses in the
"inside" and "outside" prefixes, preserving end-to-end reachability
at the network layer. 
    ' name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-bctb-6man-rfc6296-bis-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.11.6
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.0.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.10
-->
<link href="draft-bctb-6man-rfc6296-bis.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">RFC 6296bis</td>
<td class="right">November 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Wasserman, et al.</td>
<td class="center">Expires 25 May 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">6MAN</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-bctb-6man-rfc6296-bis-latest</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc6296" class="eref">6296</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-11-22" class="published">22 November 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-05-25">25 May 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Wasserman</div>
<div class="org">Painless Security</div>
</div>
<div class="author">
      <div class="author-name">F. Baker</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">O. Troan</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">N. Buraglio</div>
<div class="org">Energy Sciences Network</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">RFC 6296bis IPv6-to-IPv6 Network Prefix Translation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a stateless, transport-agnostic IPv6-to-IPv6
Network Prefix Translation (NPTv6) function that provides the
address-independence benefit associated with IPv4-to-IPv4 NAT
(NAPT44) and provides a 1:1 relationship between addresses in the
"inside" and "outside" prefixes, preserving end-to-end reachability
at the network layer.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/buraglio/rfc6296-bis">https://github.com/buraglio/rfc6296-bis</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 25 May 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-what-is-address-independenc" class="internal xref">What is Address Independence?</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-nptv6-applicability" class="internal xref">NPTv6 Applicability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-requirements-terminology" class="internal xref">Requirements Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-nptv6-overview" class="internal xref">NPTv6 Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-nptv6-the-simplest-case" class="internal xref">NPTv6: The Simplest Case</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-nptv6-redundancy-and-load-s" class="internal xref">NPTv6 Redundancy and Load Sharing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-nptv6-multihoming" class="internal xref">NPTv6 Multihoming</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-mapping-with-no-per-flow-st" class="internal xref">Mapping with No Per-Flow State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-checksum-neutral-mapping" class="internal xref">Checksum-Neutral Mapping</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-nptv6-algorithmic-specifica" class="internal xref">NPTv6 Algorithmic Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-nptv6-configuration-calcula" class="internal xref">NPTv6 Configuration Calculations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-nptv6-translation-internal-" class="internal xref">NPTv6 Translation, Internal Network to External Network</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-nptv6-translation-external-" class="internal xref">NPTv6 Translation, External Network to Internal Network</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-nptv6-with-a-48-or-shorter-" class="internal xref">NPTv6 with a /48 or Shorter Prefix</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-nptv6-with-a-49-or-longer-p" class="internal xref">NPTv6 with a /49 or Longer Prefix</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="auto internal xref">3.6</a>.  <a href="#name-48-prefix-mapping-example" class="internal xref">/48 Prefix Mapping Example</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="auto internal xref">3.7</a>.  <a href="#name-address-mapping-for-longer-" class="internal xref">Address Mapping for Longer Prefixes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8">
                <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="auto internal xref">3.8</a>.  <a href="#name-icmpv6-error-forwarding" class="internal xref">ICMPv6 error forwarding</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-implications-of-network-add" class="internal xref">Implications of Network Address Translator Behavioral Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-prefix-configuration-and-ge" class="internal xref">Prefix Configuration and Generation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-subnet-numbering" class="internal xref">Subnet Numbering</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-nat-behavioral-requirements" class="internal xref">NAT Behavioral Requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-implications-for-applicatio" class="internal xref">Implications for Applications</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-recommendation-for-network-" class="internal xref">Recommendation for Network Planners Considering Use of NPTv6</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-recommendations-for-applica" class="internal xref">Recommendations for Application Writers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-recommendation-for-future-w" class="internal xref">Recommendation for Future Work</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-a-note-on-port-mapping" class="internal xref">A Note on Port Mapping</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-why-gse" class="internal xref">Why GSE?</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-verification-code" class="internal xref">Verification Code</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes a stateless IPv6-to-IPv6 Network Prefix
Translation (NPTv6) function, designed to provide address
independence to the edge network.  It is transport-agnostic with
respect to transports that do not checksum the IP header, such as
SCTP, and to transports that use the TCP/UDP/DCCP (Datagram
Congestion Control Protocol) pseudo-header and checksum <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">For reasons discussed in <span>[<a href="#RFC2993" class="cite xref">RFC2993</a>]</span> and Section 5, the IETF does not
recommend the use of Network Address Translation technology for IPv6.
Where translation is implemented, however, this specification
provides a mechanism that has fewer architectural problems than
merely implementing a traditional stateful Network Address Translator
in an IPv6 environment.  It also provides a useful alternative to the
complexities and costs imposed by multihoming using provider-
independent addressing and the routing and network management issues
of overlaid ISP address space.  Some problems remain, however.  The
reader should consider the alternatives suggested in <span>[<a href="#RFC4864" class="cite xref">RFC4864</a>]</span> and
the considerations of <span>[<a href="#RFC5902" class="cite xref">RFC5902</a>]</span> for improved approaches.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">The stateless approach described in this document has several
ramifications:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">
          <p id="section-1-4.1.1">Any security benefit that NAPT44 might offer is not present in
    NPTv6, necessitating the use of a firewall to obtain those
    benefits if desired.  An example of such a firewall is described
    in <span>[<a href="#RFC6092" class="cite xref">RFC6092</a>]</span>.<a href="#section-1-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.2">
          <p id="section-1-4.2.1">End-to-end reachability is preserved, although the address used
    "inside" the edge network differs from the address used "outside"
    the edge network.  This has implications for application referrals
    and other uses of Internet layer addresses.<a href="#section-1-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.3">
          <p id="section-1-4.3.1">If there are multiple identically configured prefix translators
    between two networks, there is no need for them to exchange
    dynamic state, as there is no dynamic state -- the algorithmic
    translation will be identical across each of them.  The network
    can therefore asymmetrically route, load share, and fail-over
    among them without issue.<a href="#section-1-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.4">
          <p id="section-1-4.4.1">Since translation is 1:1 at the network layer, there is no need to
    modify port numbers or other transport parameters.<a href="#section-1-4.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.5">
          <p id="section-1-4.5.1">TCP sessions that authenticate peers using the TCP Authentication
    Option <span>[<a href="#RFC5925" class="cite xref">RFC5925</a>]</span> cannot have their addresses translated, as the
    addresses are used in the calculation of the Message
    Authentication Code.  This consideration applies in general to any<a href="#section-1-4.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.6">
          <p id="section-1-4.6.1">Unilateral Self-Address Fixing (UNSAF) <span>[<a href="#RFC3424" class="cite xref">RFC3424</a>]</span> Protocol, which
    the IAB recommends against the deployment of in an environment
    that changes Internet addresses.<a href="#section-1-4.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.7">
          <p id="section-1-4.7.1">Applications using the Internet Key Exchange Protocol Version 2
    (IKEv2) <span>[<a href="#RFC5996" class="cite xref">RFC5996</a>]</span> should, at least in theory, detect the presence
    of the translator; while no NAT traversal solution is required,
    <span>[<a href="#RFC5996" class="cite xref">RFC5996</a>]</span> would require such sessions to use UDP.<a href="#section-1-4.7.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="what-is-address-independence">
<section id="section-1.1">
        <h3 id="name-what-is-address-independenc">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-what-is-address-independenc" class="section-name selfRef">What is Address Independence?</a>
        </h3>
<p id="section-1.1-1">For the purposes of this document, IPv6 address independence consists
of the following set of properties:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">From the perspective of the edge network:<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-3.1">
            <p id="section-1.1-3.1.1">The IPv6 addresses used inside the local network (for
interfaces, access lists, and logs) do not need to be
renumbered if the global prefix(es) assigned for use by the
edge network are changed.<a href="#section-1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.2">
            <p id="section-1.1-3.2.1">The IPv6 addresses used inside the edge network (for
interfaces, access lists, and logs) or within other upstream
networks (such as when multihoming) do not need to be
renumbered when a site adds, drops, or changes upstream
networks.<a href="#section-1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.3">
            <p id="section-1.1-3.3.1">It is not necessary for an administration to convince an
upstream network to route its internal IPv6 prefixes or for it
to advertise prefixes derived from other upstream networks into
it.<a href="#section-1.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-3.4">
            <p id="section-1.1-3.4.1">Unless it wants to optimize routing between multiple upstream
networks in the process of multihoming, there is no need for a
BGP exchange with the upstream network.<a href="#section-1.1-3.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-4">From the perspective of the upstream network:<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-5.1">
            <p id="section-1.1-5.1.1">IPv6 addresses used by the edge network are guaranteed to have
a provider-allocated prefix, eliminating the need and concern
for BCP 38 <span>[<a href="#RFC2827" class="cite xref">RFC2827</a>]</span> ingress filtering and the advertisement of
customer-specific prefixes.<a href="#section-1.1-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-6">Thus, address independence has ramifications for the edge network,
networks it directly connects with (especially its upstream
networks), and the Internet as a whole.  The desire for address
independence has been a primary driver for IPv4 NAT deployment in
medium- to large-sized enterprise networks, including NAT deployments<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<p id="section-1.1-7">in enterprises that have plenty of IPv4 provider-independent address
space (from IPv4 "swamp space").  It has also been a driver for edge
networks to become members of Regional Internet Registry (RIR)
communities, seeking to obtain BGP Autonomous System Numbers and
provider-independent prefixes, and as a result has been one of the
drivers of the explosion of the IPv4 route table.  Service providers
have stated that the lack of address independence from their
customers has been a negative incentive to deployment, due to the
impact of customer routing expected in their networks.<a href="#section-1.1-7" class="pilcrow">¶</a></p>
<p id="section-1.1-8">The Local Network Protection <span>[<a href="#RFC4864" class="cite xref">RFC4864</a>]</span> document discusses a related
concept called "Address Autonomy" as a benefit of NAPT44.  <span>[<a href="#RFC4864" class="cite xref">RFC4864</a>]</span>
indicates that address autonomy can be achieved by the simultaneous
use of global addresses on all nodes within a site that need external
connectivity and Unique Local Addresses (ULAs) <span>[<a href="#RFC4193" class="cite xref">RFC4193</a>]</span> for all
internal communication.  However, this solution fails to meet the
requirement for address independence, because if an ISP renumbering
event occurs, all of the hosts, routers, DHCP servers, Access Control
Lists (ACLs), firewalls, and other internal systems that are
configured with global addresses from the ISP will need to be
renumbered before global connectivity is fully restored.<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<p id="section-1.1-9">The use of IPv6 provider-independent (PI) addresses has also been
suggested as a means to fulfill the address-independence requirement.
However, this solution requires that an enterprise qualify to receive
a PI assignment and persuade its ISP to install specific routes for
the enterprise's PI addresses.  There are a number of practical
issues with this approach, especially if there is a desire to route
to a number of geographically and topologically diverse sites, which
can sometimes involve coordinating with several ISPs to route
portions of a single PI prefix.  These problems have caused numerous
enterprises with plenty of IPv4 swamp space to choose to use IPv4 NAT
for part, or substantially all, of their internal network instead of
using their provider-independent address space.<a href="#section-1.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nptv6-applicability">
<section id="section-1.2">
        <h3 id="name-nptv6-applicability">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-nptv6-applicability" class="section-name selfRef">NPTv6 Applicability</a>
        </h3>
<p id="section-1.2-1">NPTv6 provides a simple and compelling solution to meet the address-
independence requirement in IPv6.  The address-independence benefit
stems directly from the translation function of the network prefix
translator.  To avoid as many of the issues associated with NAPT44 as
possible, NPTv6 is defined to include a two-way, checksum-neutral,
algorithmic translation function, and nothing else.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">The fact that NPTv6 does not map ports and is checksum-neutral avoids
the need for an NPTv6 Translator to rewrite transport layer headers.
This makes it feasible to deploy new or improved transport layer
protocols without upgrading NPTv6 Translators.  Similarly, since
NPTv6 does not rewrite transport layer headers, NPTv6 will not
interfere with encryption of the full IP payload in many cases.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">The default NPTv6 address-mapping mechanism is purely algorithmic, so
NPTv6 translators do not need to maintain per-node or per-connection
state, allowing deployment of more robust and adaptive networks than
can be deployed using NAPT44.  Since the default NPTv6 mapping can be
performed in either direction, it does not interfere with inbound
connection establishment, thus allowing internal nodes to participate
in direct Peer-to-Peer applications without the application layer
overhead one finds in many IPv4 Peer-to-Peer applications.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">Although NPTv6 compares favorably to NAPT44 in several ways, it does
not eliminate all of the architectural problems associated with IPv4
NAT, as described in <span>[<a href="#RFC2993" class="cite xref">RFC2993</a>]</span>.  NPTv6 involves modifying IP headers
in transit, so it is not compatible with security mechanisms, such as
the IPsec Authentication Header, that provide integrity protection
for the IP header.  NPTv6 may interfere with the use of application
protocols that transmit IP addresses in the application-specific
portion of the IP datagram.  These applications currently require
Application Layer Gateways (ALGs) to work correctly through NAPT44
devices, and similar ALGs may be required for these applications to
work through NPTv6 Translators.  The use of separate internal and
external prefixes creates complexity for DNS deployment, due to the
desire for internal nodes to communicate with other internal nodes
using internal addresses, while external nodes need to obtain
external addresses to communicate with the same nodes.  This
frequently results in the deployment of "split DNS", which may add
complexity to network configuration.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
<p id="section-1.2-5">The choice of address within the edge network bears consideration.
One could use a ULA, which maximizes address independence.  That
could also be considered a misuse of the ULA; if the expectation is
that a ULA prevents access to a system from outside the range of the
ULA, NPTv6 overrides that.  On the other hand, the administration is
aware that it has made that choice and could deploy a second ULA for
the purpose of privacy if it desired; the only prefix that will be
translated is one that has an NPTv6 Translator configured to
translate to or from it.  Also, using any other global-scope address
format makes one either obtain a PI prefix or be at the mercy of the
agency from which it was allocated.<a href="#section-1.2-5" class="pilcrow">¶</a></p>
<p id="section-1.2-6">There are significant technical impacts associated with the
deployment of any prefix translation mechanism, including NPTv6, and
we strongly encourage anyone who is considering the implementation or
deployment of NPTv6 to read <span>[<a href="#RFC4864" class="cite xref">RFC4864</a>]</span> and <span>[<a href="#RFC5902" class="cite xref">RFC5902</a>]</span>, and to carefully
consider the alternatives described in that document, some of which
may cause fewer problems than NPTv6.<a href="#section-1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="requirements-terminology">
<section id="section-1.3">
        <h3 id="name-requirements-terminology">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-requirements-terminology" class="section-name selfRef">Requirements Terminology</a>
        </h3>
<p id="section-1.3-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="nptv6-overview">
<section id="section-2">
      <h2 id="name-nptv6-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-nptv6-overview" class="section-name selfRef">NPTv6 Overview</a>
      </h2>
<p id="section-2-1">NPTv6 may be implemented in an IPv6 router to map one IPv6 address
   prefix to another IPv6 prefix as each IPv6 datagram transits the
   router.  A router that implements an NPTv6 prefix translation
   function is referred to as an NPTv6 Translator.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="nptv6-the-simplest-case">
<section id="section-2.1">
        <h3 id="name-nptv6-the-simplest-case">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-nptv6-the-simplest-case" class="section-name selfRef">NPTv6: The Simplest Case</a>
        </h3>
<p id="section-2.1-1">In its simplest form, an NPTv6 Translator interconnects two network
links, one of which is an "internal" network link attached to a leaf
network within a single administrative domain and the other of which
is an "external" network with connectivity to the global Internet.
All of the hosts on the internal network will use addresses from a
single, locally routed prefix, and those addresses will be translated
to/from addresses in a globally routable prefix as IP datagrams
transit the NPTv6 Translator.  The lengths of these two prefixes will
be functionally the same; if they differ, the longer of the two will
limit the ability to use subnets in the shorter.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-2">
<pre>
               External Network:  Prefix = 2001:0DB8:0001:/48
                   --------------------------------------
                                     |
                                     |
                              +-------------+
                              |     NPTv6   |
                              |  Translator |
                              +-------------+
                                     |
                                     |
                   --------------------------------------
               Internal Network:  Prefix = FD01:0203:0405:/48

                       Figure 1: A Simple Translator
</pre><a href="#section-2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1-3">Figure 1 shows an NPTv6 Translator attached to two networks.  In this
example, the internal network uses IPv6 Unique Local Addresses (ULAs)
<span>[<a href="#RFC4193" class="cite xref">RFC4193</a>]</span> to represent the internal IPv6 nodes, and the external
network uses globally routable IPv6 addresses to represent the same
nodes.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">When an NPTv6 Translator forwards datagrams in the "outbound"
direction, from the internal network to the external network, NPTv6
overwrites the IPv6 source prefix (in the IPv6 header) with a
corresponding external prefix.  When datagrams are forwarded in the
"inbound" direction, from the external network to the internal
network, the IPv6 destination prefix is overwritten with a
corresponding internal prefix.  Using the prefixes shown in the
diagram above, as an IP datagram passes through the NPTv6 Translator
in the outbound direction, the source prefix (FD01:0203:0405:/48)
will be overwritten with the external prefix (2001:0DB8:0001:/48).
In an inbound datagram, the destination prefix (2001:0DB8:0001:/48)
will be overwritten with the internal prefix (FD01:0203:0405:/48).
In both cases, it is the local IPv6 prefix that is overwritten; the
remote IPv6 prefix remains unchanged.  Nodes on the internal network
are said to be "behind" the NPTv6 Translator.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">2.2.  NPTv6 between Peer Networks<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">NPTv6 can also be used between two private networks.  In these cases,
   both networks may use ULA prefixes, with each subnet in one network
   mapped into a corresponding subnet in the other network, and vice
   versa.  Or, each network may use ULA prefixes for internal addressing
   and global unicast addresses on the other network.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-7">
<pre>
                  Internal Prefix = FD01:4444:5555:/48
                  --------------------------------------
                       V            |      External Prefix
                       V            |      2001:0DB8:6666:/48
                       V        +---------+      ^
                       V        |  NPTv6  |      ^
                       V        |  Device |      ^
                       V        +---------+      ^
              External Prefix       |            ^
              2001:0DB8:0001:/48    |            ^
                  --------------------------------------
                  Internal Prefix = FD01:0203:0405:/48

               Figure 2: Flow of Information in Translation
</pre><a href="#section-2.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="nptv6-redundancy-and-load-sharing">
<section id="section-2.2">
        <h3 id="name-nptv6-redundancy-and-load-s">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-nptv6-redundancy-and-load-s" class="section-name selfRef">NPTv6 Redundancy and Load Sharing</a>
        </h3>
<p id="section-2.2-1">In some cases, more than one NPTv6 Translator may be attached to a
   network, as shown in Figure 3.  In such cases, NPTv6 Translators are
   configured with the same internal and external prefixes.  Since there
   is only one translation, even though there are multiple translators,
   they map only one external address (prefix and Interface Identifier
   (IID)) to the internal address.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2-2">
<pre>
               External Network:  Prefix = 2001:0DB8:0001:/48
                   --------------------------------------
                          |                      |
                          |                      |
                   +-------------+        +-------------+
                   |  NPTv6      |        |  NPTv6      |
                   |  Translator |        |  Translator |
                   |   #1        |        |   #2        |
                   +-------------+        +-------------+
                          |                      |
                          |                      |
                   --------------------------------------
               Internal Network:  Prefix = FD01:0203:0405:/48

                      Figure 3: Parallel Translators
</pre><a href="#section-2.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="nptv6-multihoming">
<section id="section-2.3">
        <h3 id="name-nptv6-multihoming">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-nptv6-multihoming" class="section-name selfRef">NPTv6 Multihoming</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-2.3-1">
<pre>
            External Network #1:          External Network #2:
         Prefix = 2001:0DB8:0001:/48    Prefix = 2001:0DB8:5555:/48
         ---------------------------    --------------------------
                         |                      |
                         |                      |
                  +-------------+        +-------------+
                  |  NPTv6      |        |  NPTv6      |
                  |  Translator |        |  Translator |
                  |   #1        |        |   #2        |
                  +-------------+        +-------------+
                         |                      |
                         |                      |
                  --------------------------------------
              Internal Network:  Prefix = FD01:0203:0405:/48

      Figure 4: Parallel Translators with Different Upstream Networks
</pre><a href="#section-2.3-1" class="pilcrow">¶</a>
</div>
<p id="section-2.3-2">When multihoming, NPTv6 Translators are attached to an internal
   network, as shown in Figure 4, but are connected to different
   external networks.  In such cases, NPTv6 Translators are configured
   with the same internal prefix but different external prefixes.  Since
   there are multiple translations, they map multiple external addresses
   (prefix and IID) to the common internal address.  A system within the
   edge network is unable to determine which external address it is
   using apart from services such as Session Traversal Utilities for NAT
   (STUN) <span>[<a href="#RFC5389" class="cite xref">RFC5389</a>]</span>.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">Multihoming in this sense has one negative feature as compared with
   multihoming with a provider-independent address: when routes change
   between NPTv6 Translators, the translated prefix can change since the
   upstream network changes.  This causes sessions and referrals
   dependent on it to fail as well.  This is not expected to be a major
   issue, however, in networks where routing is generally stable.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mapping-with-no-per-flow-state">
<section id="section-2.4">
        <h3 id="name-mapping-with-no-per-flow-st">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-mapping-with-no-per-flow-st" class="section-name selfRef">Mapping with No Per-Flow State</a>
        </h3>
<p id="section-2.4-1">When NPTv6 is used as described in this document, no per-node or per-
   flow state is maintained in the NPTv6 Translator.  Both inbound and
   outbound datagrams are translated algorithmically, using only
   information found in the IPv6 header.  Due to this property, NPTv6's
   two-way, algorithmic address mapping can support both outbound and
   inbound connection establishment without the need for maintenance of
   mapping state or for state-priming or rendezvous mechanisms.  This is
   a significant improvement over NAPT44 devices, but it also has
   significant security implications, which are described in Section 7.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="checksum-neutral-mapping">
<section id="section-2.5">
        <h3 id="name-checksum-neutral-mapping">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-checksum-neutral-mapping" class="section-name selfRef">Checksum-Neutral Mapping</a>
        </h3>
<p id="section-2.5-1">When a change is made to one of the IP header fields in the IPv6
   pseudo-header checksum (such as one of the IP addresses), the
   checksum field in the transport layer header may become invalid.
   Fortunately, an incremental change in the area covered by the
   Internet standard checksum <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span> will result in a well-defined
   change to the checksum value <span>[<a href="#RFC1624" class="cite xref">RFC1624</a>]</span>.  So, a checksum change caused
   by modifying part of the area covered by the checksum can be
   corrected by making a complementary change to a different 16-bit
   field covered by the same checksum.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">The NPTv6 mapping mechanisms described in this document are checksum-
   neutral, which means that they result in IP headers that will
   generate the same IPv6 pseudo-header checksum when the checksum is
   calculated using the standard Internet checksum algorithm <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span>.
   Any changes that are made during translation of the IPv6 prefix are
   offset by changes to other parts of the IPv6 address.  This results
   in transport layers that use the Internet checksum (such as TCP and
   UDP) calculating the same IPv6 pseudo-header checksum for both the
   internal and external forms of the same datagram, which avoids the
   need for the NPTv6 Translator to modify those transport layer headers
   to correct the checksum value.<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<p id="section-2.5-3">The outgoing checksum correction is achieved by making a change to a
   16-bit section of the source address that is not used for routing in
   the external network.  Due to the nature of checksum arithmetic, when
   the corresponding correction is applied to the same bits of
   destination address of the inbound packet, the Destination Address
   (DA) is returned to the correct internal value.<a href="#section-2.5-3" class="pilcrow">¶</a></p>
<p id="section-2.5-4">As noted in Section 4.2, this mapping results in an edge network
   using a /48 external prefix to be unable to use subnet 0xFFFF.<a href="#section-2.5-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="nptv6-algorithmic-specification">
<section id="section-3">
      <h2 id="name-nptv6-algorithmic-specifica">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-nptv6-algorithmic-specifica" class="section-name selfRef">NPTv6 Algorithmic Specification</a>
      </h2>
<p id="section-3-1">The <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span> IPv6 Address is reproduced for clarity in Figure 5.
   ~~~~~~~~~~<a href="#section-3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-2">
<pre>
  0    15 16   31 32   47 48   63 64   79 80   95 96  111 112  127
 +-------+-------+-------+-------+-------+-------+-------+-------+
 |     Routing Prefix    | Subnet|   Interface Identifier (IID)  |
 +-------+-------+-------+-------+-------+-------+-------+-------+

        Figure 5: Enumeration of the IPv6 Address {{RFC4291}} ~~~~~~~~~~
</pre><a href="#section-3-2" class="pilcrow">¶</a>
</div>
<div id="nptv6-configuration-calculations">
<section id="section-3.1">
        <h3 id="name-nptv6-configuration-calcula">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-nptv6-configuration-calcula" class="section-name selfRef">NPTv6 Configuration Calculations</a>
        </h3>
<p id="section-3.1-1">When an NPTv6 Translation function is configured, it is configured
   with<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">one or more "internal" interfaces with their "internal" routing
    domain prefixes, and<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">one or more "external" interfaces with their "external" routing
    domain prefixes.<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-3.1-2.2.2">
In the simple case, there is one of each.  If a single router
 provides NPTv6 translation services between a multiplicity of domains
 (as might be true when multihoming), each internal/external pair must
 be thought of as a separate NPTv6 Translator from the perspective of
 this specification.<a href="#section-3.1-2.2.2" class="pilcrow">¶</a></p>
<p id="section-3.1-2.2.3">
When an NPTv6 Translator is configured, the translation function
 first ensures that the internal and external prefixes are the same
 length, extending the shorter of the two with zeroes if necessary.
 These two prefixes will be used in the prefix translation function
 described in Sections 3.2 and 3.3.<a href="#section-3.1-2.2.3" class="pilcrow">¶</a></p>
<p id="section-3.1-2.2.4">
They are then zero-extended to /64 for the purposes of a calculation.
 The translation function calculates the one's complement sum of the
 16-bit words of the /64 external prefix and the /64 internal prefix.
 It then calculates the difference between these values: internal
 minus external.  This value, called the "adjustment", is effectively
 constant for the lifetime of the NPTv6 Translator configuration and
 is used in per-datagram processing.<a href="#section-3.1-2.2.4" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="nptv6-translation-internal-network-to-external-network">
<section id="section-3.2">
        <h3 id="name-nptv6-translation-internal-">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-nptv6-translation-internal-" class="section-name selfRef">NPTv6 Translation, Internal Network to External Network</a>
        </h3>
<p id="section-3.2-1">When a datagram passes through the NPTv6 Translator from an internal
   to an external network, its IPv6 Source Address is either changed in
   two ways or results in the datagram being discarded:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">
            <p id="section-3.2-2.1.1">If the internal subnet number has no mapping, such as being 0xFFFF
    or simply not mapped, discard the datagram.  This SHOULD result in
    an ICMP Destination Unreachable.<a href="#section-3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">The internal prefix is overwritten with the external prefix, in
    effect subtracting the difference between the two checksums (the
    adjustment) from the pseudo-header's checksum, and<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-2.3">
            <p id="section-3.2-2.3.1">A 16-bit word of the address has the adjustment added to it using
    one's complement arithmetic.  If the result is 0xFFFF, it is
    overwritten as zero.  The choice of word is as specified in
    Sections 3.4 or 3.5 as appropriate.<a href="#section-3.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="nptv6-translation-external-network-to-internal-network">
<section id="section-3.3">
        <h3 id="name-nptv6-translation-external-">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-nptv6-translation-external-" class="section-name selfRef">NPTv6 Translation, External Network to Internal Network</a>
        </h3>
<p id="section-3.3-1">When a datagram passes through the NPTv6 Translator from an external
   to an internal network, its IPv6 Destination Address is changed in
   two ways:<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.1">
            <p id="section-3.3-2.1.1">The external prefix is overwritten with the internal prefix, in
    effect adding the difference between the two checksums (the
    adjustment) to the pseudo-header's checksum, and<a href="#section-3.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-2.2">
            <p id="section-3.3-2.2.1">A 16-bit word of the address has the adjustment subtracted from it
    (bitwise inverted and added to it) using one's complement
    arithmetic.  If the result is 0xFFFF, it is overwritten as zero.
    The choice of word is as specified in Section 3.4 or Section 3.5
    as appropriate.<a href="#section-3.3-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="nptv6-with-a-48-or-shorter-prefix">
<section id="section-3.4">
        <h3 id="name-nptv6-with-a-48-or-shorter-">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-nptv6-with-a-48-or-shorter-" class="section-name selfRef">NPTv6 with a /48 or Shorter Prefix</a>
        </h3>
<p id="section-3.4-1">When an NPTv6 Translator is configured with internal and external
   prefixes that are 48 bits in length (a /48) or shorter, the
   adjustment MUST be added to or subtracted from bits 48..63 of the
   address.
   This mapping results in no modification of the Interface Identifier
   (IID), which is held in the lower half of the IPv6 address, so it
   will not interfere with future protocols that may use unique IIDs for
   node identification.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">NPTv6 Translator implementations MUST implement the /48 mapping.<a href="#section-3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nptv6-with-a-49-or-longer-prefix">
<section id="section-3.5">
        <h3 id="name-nptv6-with-a-49-or-longer-p">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-nptv6-with-a-49-or-longer-p" class="section-name selfRef">NPTv6 with a /49 or Longer Prefix</a>
        </h3>
<p id="section-3.5-1">When an NPTv6 Translator is configured with internal and external
   prefixes that are longer than 48 bits in length (such as a /52, /56,
   or /60), the adjustment must be added to or subtracted from one of
   the words in bits 64..79, 80..95, 96..111, or 112..127 of the
   address.  While the choice of word is immaterial as long as it is
   consistent, these words MUST be inspected in that sequence and the
   first that is not initially 0xFFFF chosen, for consistency's sake.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">NPTv6 Translator implementations SHOULD implement the mapping for
   longer prefixes.<a href="#section-3.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="prefix-mapping-example">
<section id="section-3.6">
        <h3 id="name-48-prefix-mapping-example">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-48-prefix-mapping-example" class="section-name selfRef">/48 Prefix Mapping Example</a>
        </h3>
<p id="section-3.6-1">For the network shown in Figure 1, the Internal Prefix is FD01:0203:
   0405:/48, and the External Prefix is 2001:0DB8:0001:/48.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<p id="section-3.6-2">If a node with internal address FD01:0203:0405:0001::1234 sends an
   outbound datagram through the NPTv6 Translator, the resulting
   external address will be 2001:0DB8:0001:D550::1234.  The resulting
   address is obtained by calculating the checksum of both the internal
   and external 48-bit prefixes, subtracting the internal prefix from
   the external prefix using one's complement arithmetic to calculate
   the "adjustment", and adding the adjustment to the 16-bit subnet
   field (in this case, 0x0001).<a href="#section-3.6-2" class="pilcrow">¶</a></p>
<p id="section-3.6-3">To show the work:<a href="#section-3.6-3" class="pilcrow">¶</a></p>
<p id="section-3.6-4">The one's complement checksum of FD01:0203:0405 is 0xFCF5.  The one's
   complement checksum of 2001:0DB8:0001 is 0xD245.  Using one's
   complement arithmetic, 0xD245 - 0xFCF5 = 0xD54F.  The subnet in the
   original datagram is 0x0001.  Using one's complement arithmetic,
   0x0001 + 0xD54F = 0xD550.  Since 0xD550 != 0xFFFF, it is not changed
   to 0x0000.<a href="#section-3.6-4" class="pilcrow">¶</a></p>
<p id="section-3.6-5">So, the value 0xD550 is written in the 16-bit subnet area, resulting
   in a mapped external address of 2001:0DB8:0001:D550::1234.<a href="#section-3.6-5" class="pilcrow">¶</a></p>
<p id="section-3.6-6">When a response datagram is received, it will contain the destination
   address 2001:0DB8:0001:D550::1234, which will be mapped back to FD01:
   0203:0405:0001::1234 using the inverse mapping algorithm.<a href="#section-3.6-6" class="pilcrow">¶</a></p>
<p id="section-3.6-7">In this case, the difference between the two prefixes will be
   calculated as follows:<a href="#section-3.6-7" class="pilcrow">¶</a></p>
<p id="section-3.6-8">Using one's complement arithmetic, 0xFCF5 - 0xD245 = 0x2AB0.  The
   subnet in the original datagram = 0xD550.  Using one's complement
   arithmetic, 0xD550 + 0x2AB0 = 0x0001.  Since 0x0001 != 0xFFFF, it is
   not changed to 0x0000.<a href="#section-3.6-8" class="pilcrow">¶</a></p>
<p id="section-3.6-9">So the value 0x0001 is written into the subnet field, and the
   internal value of the subnet field is properly restored.<a href="#section-3.6-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="address-mapping-for-longer-prefixes">
<section id="section-3.7">
        <h3 id="name-address-mapping-for-longer-">
<a href="#section-3.7" class="section-number selfRef">3.7. </a><a href="#name-address-mapping-for-longer-" class="section-name selfRef">Address Mapping for Longer Prefixes</a>
        </h3>
<p id="section-3.7-1">If the prefix being mapped is longer than 48 bits, the algorithm is
   slightly more complex.  A common case will be that the internal and
   external prefixes are of different lengths.  In such a case, the
   shorter prefix is zero-extended to the length of the longer as
   described in Section 3.1 for the purposes of overwriting the prefix.
   Then, they are both zero-extended to 64 bits to facilitate one's
   complement arithmetic.  The "adjustment" is calculated using those
   64-bit prefixes.<a href="#section-3.7-1" class="pilcrow">¶</a></p>
<p id="section-3.7-2">For example, if the internal prefix is a /48 ULA and the external
   prefix is a /56 provider-allocated prefix, the ULA becomes a /56 with
   zeros in bits 48..55.  For purposes of one's complement arithmetic,
   they are then both zero-extended to 64 bits.  A side effect of this
   is that a subset of the subnets possible in the shorter prefix is
   untranslatable.  While the security value of this is debatable, the
   administration may choose to use them for subnets that it knows need
   no external accessibility.<a href="#section-3.7-2" class="pilcrow">¶</a></p>
<p id="section-3.7-3">We then find the first word in the IID that does not have the value
   0xFFFF, trying bits 64..79, and then 80..95, 96..111, and finally
   112..127.  We perform the same calculation (with the same proof of
   correctness) as in Section 3.6 but apply it to that word.<a href="#section-3.7-3" class="pilcrow">¶</a></p>
<p id="section-3.7-4">Although any 16-bit portion of an IPv6 IID could contain 0xFFFF, an
   IID of all-ones is a reserved anycast identifier that should not be
   used on the network <span>[<a href="#RFC2526" class="cite xref">RFC2526</a>]</span>.  If an NPTv6 Translator discovers a
   datagram with an IID of all-zeros while performing address mapping,
   that datagram MUST be dropped, and an ICMPv6 Parameter Problem error
   SHOULD be generated <span>[<a href="#RFC4443" class="cite xref">RFC4443</a>]</span>.
   Note: This mechanism does involve modification of the IID; it may not
   be compatible with future mechanisms that use unique IIDs for node
   identification.<a href="#section-3.7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="icmpv6-error-forwarding">
<section id="section-3.8">
        <h3 id="name-icmpv6-error-forwarding">
<a href="#section-3.8" class="section-number selfRef">3.8. </a><a href="#name-icmpv6-error-forwarding" class="section-name selfRef">ICMPv6 error forwarding</a>
        </h3>
<p id="section-3.8-1">This section describes the processing of ICMPv6 error messages and is similar to
   the ICMP error forwarding specified for IPv4 NATs in <span>[<a href="#RFC5508" class="cite xref">RFC5508</a>]</span>.<a href="#section-3.8-1" class="pilcrow">¶</a></p>
<p id="section-3.8-2">For an ICMPv6 error, both the addresses in the outer IPv6 header and the embedded IPv6 header
   in the ICMPv6 error message must be translated.<a href="#section-3.8-2" class="pilcrow">¶</a></p>
<p id="section-3.8-3">For an ICMPv6 error received from the "outside", the embedded IPv6 header source address
   is translated from the external prefix to the internal prefix. While the outer IPv6 header
   destination address is translated from the external prefix to the internal prefix as normal.
   If the embedded IPv6 source address prefix does not match the external prefix prior to the rewrite,
   the packet MUST be silently dropped.<a href="#section-3.8-3" class="pilcrow">¶</a></p>
<p id="section-3.8-4">For an ICMPv6 error received from the "inside", the embedded IPv6 header destination address
   is translated from the internal prefix to the external prefix. While the outer IPv6 header
   source address is translated from the internal prefix to the external prefix as normal.
   If the embedded IPv6 destination address prefix does not match the internal prefix prior to the rewrite,
   the packet MUST be silently dropped.<a href="#section-3.8-4" class="pilcrow">¶</a></p>
<p id="section-3.8-5">The ICMPv6 forwarding function MUST verify that the length of the embedded pacekt is long enough to contain the whole IPv6 header.<a href="#section-3.8-5" class="pilcrow">¶</a></p>
<p id="section-3.8-6">An ICMPv6 Error message checksum covers the entire ICMPv6 message,
   including the payload.  When an ICMPv6 Error packet is received, if the
   ICMPv6 checksum fails to validate, NPTv6 SHOULD silently drop the
   ICMPv6 Error packet.  This is because NATv6 uses the embedded IPv6 and
   transport headers for forwarding and translating the ICMPv6 Error
   message.  When the ICMPv6 checksum is
   invalid, the embedded IPv6 and transport headers, which are covered by
   the ICMPv6 checksum, are also suspect.<a href="#section-3.8-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implications-of-network-address-translator-behavioral-requirements">
<section id="section-4">
      <h2 id="name-implications-of-network-add">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-implications-of-network-add" class="section-name selfRef">Implications of Network Address Translator Behavioral Requirements</a>
      </h2>
<div id="prefix-configuration-and-generation">
<section id="section-4.1">
        <h3 id="name-prefix-configuration-and-ge">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-prefix-configuration-and-ge" class="section-name selfRef">Prefix Configuration and Generation</a>
        </h3>
<p id="section-4.1-1">NPTv6 Translators MUST support manual configuration of internal and
   external prefixes and MUST NOT place any restrictions on those
   prefixes except that they be valid IPv6 unicast prefixes as described
   in <span>[<a href="#RFC4291" class="cite xref">RFC4291</a>]</span>.  They MAY also support random generation of ULA
   addresses on command.  Since the most common place anticipated for
   the implementation of an NPTv6 Translator is a Customer Premises
   Equipment (CPE) router, the reader is urged to consider the
   requirements of <span>[<a href="#RFC6204" class="cite xref">RFC6204</a>]</span>.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="subnet-numbering">
<section id="section-4.2">
        <h3 id="name-subnet-numbering">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-subnet-numbering" class="section-name selfRef">Subnet Numbering</a>
        </h3>
<p id="section-4.2-1">For reasons detailed in Appendix B, a network using NPTv6 Translation
   and a /48 external prefix MUST NOT use the value 0xFFFF to designate
   a subnet that it expects to be translated.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nat-behavioral-requirements">
<section id="section-4.3">
        <h3 id="name-nat-behavioral-requirements">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-nat-behavioral-requirements" class="section-name selfRef">NAT Behavioral Requirements</a>
        </h3>
<p id="section-4.3-1">NPTv6 Translators MUST support hairpinning behavior, as defined in
   the NAT Behavioral Requirements for UDP document <span>[<a href="#RFC4787" class="cite xref">RFC4787</a>]</span>.  This
   means that when an NPTv6 Translator receives a datagram on the
   internal interface that has a destination address that matches the
   site's external prefix, it will translate the datagram and forward it
   internally.  This allows internal nodes to reach other internal nodes
   using their external, global addresses when necessary.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Conceptually, the datagram leaves the domain (is translated as
   described in Section 3.2) and returns (is again translated as
   described in Section 3.3).  As a result, the datagram exchange will
   be through the NPTv6 Translator in both directions for the lifetime
   of the session.  The alternative would be to require the NPTv6
   Translator to drop the datagram, forcing the sender to use the
   correct internal prefix for its peer.  Performing only the external-
   to-internal translation results in the datagram being sent from the
   untranslated internal address of the source to the translated and
   therefore internal address of its peer, which would enable the
   session to bypass the NPTv6 Translator for future datagrams.  It
   would also mean that the original sender would be unlikely to
   recognize the response when it arrived.
   Because NPTv6 does not perform port mapping and uses a one-to-one,
   reversible-mapping algorithm, none of the other NAT behavioral
   requirements apply to NPTv6.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implications-for-applications">
<section id="section-5">
      <h2 id="name-implications-for-applicatio">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-implications-for-applicatio" class="section-name selfRef">Implications for Applications</a>
      </h2>
<p id="section-5-1">NPTv6 Translation does not create several of the problems known to
   exist with other kinds of NATs as discussed in <span>[<a href="#RFC2993" class="cite xref">RFC2993</a>]</span>.  In
   particular, NPTv6 Translation is stateless, so a "reset" or brief
   outage of an NPTv6 Translator does not break connections that
   traverse the translation function, and if multiple NPTv6 Translators
   exist between the same two networks, the load can shift or be
   dynamically load shared among them.  Also, an NPTv6 Translator does
   not aggregate traffic for several hosts/interfaces behind a fewer
   number of external addresses, so there is no inherent expectation for
   an NPTv6 Translator to block new inbound flows from external hosts
   and no issue with a filter or blacklist associated with one prefix
   within the domain affecting another.  A firewall can, of course, be
   used in conjunction with an NPTv6 Translator; this would allow the
   network administrator more flexibility to specify security policy
   than would be possible with a traditional NAT.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">However, NPTv6 Translation does create difficulties for some kinds of
   applications.  Some examples include:<a href="#section-5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-3.1">
          <p id="section-5-3.1.1">An application instance "behind" an NPTv6 Translator will see a
    different address for its connections than its peers "outside" the
    NPTv6 Translator.<a href="#section-5-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.2">
          <p id="section-5-3.2.1">An application instance "outside" an NPTv6 Translator will see a
    different address for its connections than any peer "inside" an
    NPTv6 Translator.<a href="#section-5-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.3">
          <p id="section-5-3.3.1">An application instance wishing to establish communication with a
    peer "behind" an NPTv6 Translator may need to use a different
    address to reach that peer depending on whether the instance is
    behind the same NPTv6 Translator or external to it.  Since an
    NPTv6 Translator implements hairpinning (Section 4.3), it suffices
    for applications to always use their external addresses.  However,
    this creates inefficiencies in the local network and may also
    complicate implementation of the NPTv6 Translator.  <span>[<a href="#RFC6724" class="cite xref">RFC6724</a>]</span> also
    would prefer the private address in such a case in order to reduce
    those inefficiencies.<a href="#section-5-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.4">
          <p id="section-5-3.4.1">An application instance that moves from a realm "behind" an NPTv6
    Translator to a realm that is "outside" the network, or vice
    versa, may find that it is no longer able to reach its peers at
    the same addresses it was previously able to use.<a href="#section-5-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-3.5">
          <p id="section-5-3.5.1">An application instance that is intermittently communicating with
    a peer that moves from behind an NPTv6 Translator to "outside" of
    it, or vice versa, may find that it is no longer able to reach
    that peer at the same address that it had previously used.<a href="#section-5-3.5.1" class="pilcrow">¶</a></p>
<p id="section-5-3.5.2">
Many, but not all, of the applications that are adversely affected by
 NPTv6 Translation are those that do "referrals" -- where an
 application instance passes its own addresses, and/or addresses of
 its peers, to other peers.  (Some believe referrals are inherently
 undesirable; others believe that they are necessary in some
 circumstances.  A discussion of the merits of referrals, or lack
 thereof, is beyond the scope of this document.)<a href="#section-5-3.5.2" class="pilcrow">¶</a></p>
<p id="section-5-3.5.3">
To some extent, the incidence of these difficulties can be reduced by
 DNS hacks that attempt to expose addresses "behind" an NPTv6
 Translator only to hosts that are also behind the same NPTv6
 Translator and perhaps to also expose only the "internal" addresses
 of hosts behind the NPTv6 Translator to other hosts behind the same
 NPTv6 Translator.  However, this cannot be a complete solution.  A
 full discussion of these issues is out of scope for this document,
 but briefly: (a) reliance on DNS to solve this problem depends on
 hosts always making queries from DNS servers in the same realm as
 they are (or on DNS interception proxies, which create their own
 problems) and on mobile hosts/applications not caching those results;
 (b) reliance on DNS to solve this problem depends on network
 administrators on all networks using such applications to reliably
 and accurately maintain current DNS entries for every host using
 those applications; and (c) reliance on DNS to solve this problem
 depends on applications always using DNS names, even though they
 often must run in environments where DNS names are not reliably
 maintained for every host.  Other issues are that there is often no
 single distinguished name for a host and no reliable way for a host
 to determine what DNS names are associated with it and which names
 are appropriate to use in which contexts.<a href="#section-5-3.5.3" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="recommendation-for-network-planners-considering-use-of-nptv6">
<section id="section-5.1">
        <h3 id="name-recommendation-for-network-">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-recommendation-for-network-" class="section-name selfRef">Recommendation for Network Planners Considering Use of NPTv6</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.1-1">
<pre>
  Translation
</pre><a href="#section-5.1-1" class="pilcrow">¶</a>
</div>
<p id="section-5.1-2">In light of the above, network planners considering the use of NPTv6
   translation should carefully consider the kinds of applications that
   they will need to run in the future and determine whether the
   address-stability and provider-independence benefits are consistent
   with their application requirements.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recommendations-for-application-writers">
<section id="section-5.2">
        <h3 id="name-recommendations-for-applica">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-recommendations-for-applica" class="section-name selfRef">Recommendations for Application Writers</a>
        </h3>
<p id="section-5.2-1">Several mechanisms (e.g., STUN <span>[<a href="#RFC5389" class="cite xref">RFC5389</a>]</span>, Traversal Using Relays
   around NAT (TURN) <span>[<a href="#RFC5766" class="cite xref">RFC5766</a>]</span>, and Interactive Connectivity
   Establishment (ICE) <span>[<a href="#RFC5245" class="cite xref">RFC5245</a>]</span>) have been used with traditional IPv4
   NAT to circumvent some of the limitations of such devices.  Similar
   mechanisms could also be applied to circumvent some of the issues
   with an NPTv6 Translator.  However, all of these require the
   assistance of an external server or a function co-located with the
   translator that can tell an "internal" host what its "external"
   addresses are.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recommendation-for-future-work">
<section id="section-5.3">
        <h3 id="name-recommendation-for-future-w">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-recommendation-for-future-w" class="section-name selfRef">Recommendation for Future Work</a>
        </h3>
<p id="section-5.3-1">It might be desirable to define a general mechanism that would allow
   hosts within a translation domain to determine their external
   addresses and/or request that inbound traffic be permitted.  If such
   a mechanism were to be defined, it would ideally be general enough to
   also accommodate other types of NAT likely to be encountered by IPV6
   applications, in particular IPv4/IPv6 Translation <span>[<a href="#RFC6144" class="cite xref">RFC6144</a>]</span> <span>[<a href="#RFC6147" class="cite xref">RFC6147</a>]</span>
          <span>[<a href="#RFC6145" class="cite xref">RFC6145</a>]</span> <span>[<a href="#RFC6146" class="cite xref">RFC6146</a>]</span> <span>[<a href="#RFC6052" class="cite xref">RFC6052</a>]</span>.  For this and other reasons, such a
   mechanism is beyond the scope of this document.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="a-note-on-port-mapping">
<section id="section-6">
      <h2 id="name-a-note-on-port-mapping">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-a-note-on-port-mapping" class="section-name selfRef">A Note on Port Mapping</a>
      </h2>
<p id="section-6-1">In addition to overwriting IP addresses when datagrams are forwarded,
   NAPT44 devices overwrite the source port number in outbound traffic
   and the destination port number in inbound traffic.  This mechanism
   is called "port mapping".<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The major benefit of port mapping is that it allows multiple
   computers to share a single IPv4 address.  A large number of internal
   IPv4 addresses (typically from one of the <span>[<a href="#RFC1918" class="cite xref">RFC1918</a>]</span> private address
   spaces) can be mapped into a single external, globally routable IPv4
   address, with the local port number used to identify which internal
   node should receive each inbound datagram.  This address-
   amplification feature is not generally foreseen as a necessity at
   this time.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Since port mapping requires rewriting a portion of the transport
   layer header, it requires NAPT44 devices to be aware of all of the
   transport protocols that they forward, thus stifling the development
   of new and improved transport protocols and preventing the use of
   IPsec encryption.  Modifying the transport layer header is
   incompatible with security mechanisms that encrypt the full IP
   payload and restricts the NAPT44 to forwarding transport layers that
   use weak checksum algorithms that are easily recalculated in routers.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Since there is significant detriment caused by modifying transport
   layer headers and very little, if any, benefit to the use of port
   mapping in IPv6, NPTv6 Translators that comply with this
   specification MUST NOT perform port mapping.<a href="#section-6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">When NPTv6 is deployed using either of the two-way, algorithmic
   mappings defined in this document, it allows direct inbound
   connections to internal nodes.  While this can be viewed as a benefit
   of NPTv6 versus NAPT44, it does open internal nodes to attacks that
   would be more difficult in a NAPT44 network.  From a security
   standpoint, although this situation is not substantially worse than
   running IPv6 with no NAT, some enterprises may assume that an NPTv6
   Translator will offer similar protection to a NAPT44 device.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">The port mapping mechanism in NAPT44 implementations requires that
   state be created in both directions.  This has lead to an industry-
   wide perception that NAT functionality is the same as a stateful
   firewall.  It is not.  The translation function of the NAT only
   creates dynamic state in one direction and has no policy.  For this
   reason, it is RECOMMENDED that NPTv6 Translators also implement
   firewall functionality such as described in <span>[<a href="#RFC6092" class="cite xref">RFC6092</a>]</span>, with
   appropriate configuration options including turning it on or off.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">When <span>[<a href="#RFC4864" class="cite xref">RFC4864</a>]</span> talks about randomizing the subnet identifier, the
   idea is to make it harder for worms to guess a valid subnet
   identifier at an advertised network prefix.  This should not be
   interpreted as endorsing concealment of the subnet identifier behind
   the obfuscating function of a translator such as NPTv6.  <span>[<a href="#RFC4864" class="cite xref">RFC4864</a>]</span>
   specifically talks about how to obtain the desired properties of
   concealment without using a translator.  Topology hiding when using
   NAT is often ineffective in environments where the topology is
   visible in application layer messaging protocols such as DNS, SIP,
   SMTP, etc.  If the information were not available through the
   application layer, <span>[<a href="#RFC2993" class="cite xref">RFC2993</a>]</span> would not be valid.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Due to the potential interactions with IKEv2/IPsec NAT traversal, it
   would be valuable to test interactions of NPTv6 with various aspects
   of current-day IKEv2/IPsec NAT traversal.<a href="#section-7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-8">
      <h2 id="name-acknowledgements">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-8-1">The checksum-neutral algorithmic address mapping described in this
   document is based on email written by Iljtsch van Beijnum.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">The following people provided advice or review comments that
   substantially improved this document: Allison Mankin, Christian
   Huitema, Dave Thaler, Ed Jankiewicz, Eric Kline, Iljtsch van Beijnum,
   Jari Arkko, Keith Moore, Mark Townsley, Merike Kaeo, Ralph Droms,
   Remi Despres, Steve Blake, and Tony Hain.<a href="#section-8-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC4193">[RFC4193]</dt>
        <dd>
<span class="refAuthor">Hinden, R.</span> and <span class="refAuthor">B. Haberman</span>, <span class="refTitle">"Unique Local IPv6 Unicast Addresses"</span>, <span class="seriesInfo">RFC 4193</span>, <span class="seriesInfo">DOI 10.17487/RFC4193</span>, <time datetime="2005-10" class="refDate">October 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4193">https://www.rfc-editor.org/info/rfc4193</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4291">[RFC4291]</dt>
        <dd>
<span class="refAuthor">Hinden, R.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"IP Version 6 Addressing Architecture"</span>, <span class="seriesInfo">RFC 4291</span>, <span class="seriesInfo">DOI 10.17487/RFC4291</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4291">https://www.rfc-editor.org/info/rfc4291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2526">[RFC2526]</dt>
        <dd>
<span class="refAuthor">Johnson, D.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"Reserved IPv6 Subnet Anycast Addresses"</span>, <span class="seriesInfo">RFC 2526</span>, <span class="seriesInfo">DOI 10.17487/RFC2526</span>, <time datetime="1999-03" class="refDate">March 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2526">https://www.rfc-editor.org/info/rfc2526</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4443">[RFC4443]</dt>
        <dd>
<span class="refAuthor">Conta, A.</span>, <span class="refAuthor">Deering, S.</span>, and <span class="refAuthor">M. Gupta, Ed.</span>, <span class="refTitle">"Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 89</span>, <span class="seriesInfo">RFC 4443</span>, <span class="seriesInfo">DOI 10.17487/RFC4443</span>, <time datetime="2006-03" class="refDate">March 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4443">https://www.rfc-editor.org/info/rfc4443</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4787">[RFC4787]</dt>
      <dd>
<span class="refAuthor">Audet, F., Ed.</span> and <span class="refAuthor">C. Jennings</span>, <span class="refTitle">"Network Address Translation (NAT) Behavioral Requirements for Unicast UDP"</span>, <span class="seriesInfo">BCP 127</span>, <span class="seriesInfo">RFC 4787</span>, <span class="seriesInfo">DOI 10.17487/RFC4787</span>, <time datetime="2007-01" class="refDate">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4787">https://www.rfc-editor.org/info/rfc4787</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="GSE">[GSE]</dt>
        <dd>
<span class="refAuthor">O'Dell, M.</span>, <span class="refTitle">"GSE - An Alternate Addressing Architecture for IPv6"</span>, <time datetime="1997-02" class="refDate">February 1997</time>. </dd>
<dd class="break"></dd>
<dt id="NIST">[NIST]</dt>
        <dd>
<span class="refAuthor">NIST</span>, <span class="refTitle">"Draft NIST Framework and Roadmap for Smart Grid Interoperability Standards, Release 1.0"</span>, <time datetime="2009-09" class="refDate">September 2009</time>. </dd>
<dd class="break"></dd>
<dt id="RFC1071">[RFC1071]</dt>
        <dd>
<span class="refAuthor">Braden, R.</span>, <span class="refAuthor">Borman, D.</span>, and <span class="refAuthor">C. Partridge</span>, <span class="refTitle">"Computing the Internet checksum"</span>, <span class="seriesInfo">RFC 1071</span>, <span class="seriesInfo">DOI 10.17487/RFC1071</span>, <time datetime="1988-09" class="refDate">September 1988</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1071">https://www.rfc-editor.org/info/rfc1071</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2993">[RFC2993]</dt>
        <dd>
<span class="refAuthor">Hain, T.</span>, <span class="refTitle">"Architectural Implications of NAT"</span>, <span class="seriesInfo">RFC 2993</span>, <span class="seriesInfo">DOI 10.17487/RFC2993</span>, <time datetime="2000-11" class="refDate">November 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2993">https://www.rfc-editor.org/info/rfc2993</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4864">[RFC4864]</dt>
        <dd>
<span class="refAuthor">Van de Velde, G.</span>, <span class="refAuthor">Hain, T.</span>, <span class="refAuthor">Droms, R.</span>, <span class="refAuthor">Carpenter, B.</span>, and <span class="refAuthor">E. Klein</span>, <span class="refTitle">"Local Network Protection for IPv6"</span>, <span class="seriesInfo">RFC 4864</span>, <span class="seriesInfo">DOI 10.17487/RFC4864</span>, <time datetime="2007-05" class="refDate">May 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4864">https://www.rfc-editor.org/info/rfc4864</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5902">[RFC5902]</dt>
        <dd>
<span class="refAuthor">Thaler, D.</span>, <span class="refAuthor">Zhang, L.</span>, and <span class="refAuthor">G. Lebovitz</span>, <span class="refTitle">"IAB Thoughts on IPv6 Network Address Translation"</span>, <span class="seriesInfo">RFC 5902</span>, <span class="seriesInfo">DOI 10.17487/RFC5902</span>, <time datetime="2010-07" class="refDate">July 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5902">https://www.rfc-editor.org/info/rfc5902</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6092">[RFC6092]</dt>
        <dd>
<span class="refAuthor">Woodyatt, J., Ed.</span>, <span class="refTitle">"Recommended Simple Security Capabilities in Customer Premises Equipment (CPE) for Providing Residential IPv6 Internet Service"</span>, <span class="seriesInfo">RFC 6092</span>, <span class="seriesInfo">DOI 10.17487/RFC6092</span>, <time datetime="2011-01" class="refDate">January 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6092">https://www.rfc-editor.org/info/rfc6092</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5925">[RFC5925]</dt>
        <dd>
<span class="refAuthor">Touch, J.</span>, <span class="refAuthor">Mankin, A.</span>, and <span class="refAuthor">R. Bonica</span>, <span class="refTitle">"The TCP Authentication Option"</span>, <span class="seriesInfo">RFC 5925</span>, <span class="seriesInfo">DOI 10.17487/RFC5925</span>, <time datetime="2010-06" class="refDate">June 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5925">https://www.rfc-editor.org/info/rfc5925</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3424">[RFC3424]</dt>
        <dd>
<span class="refAuthor">Daigle, L., Ed.</span> and <span class="refAuthor">IAB</span>, <span class="refTitle">"IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation"</span>, <span class="seriesInfo">RFC 3424</span>, <span class="seriesInfo">DOI 10.17487/RFC3424</span>, <time datetime="2002-11" class="refDate">November 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3424">https://www.rfc-editor.org/info/rfc3424</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5996">[RFC5996]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">RFC 5996</span>, <span class="seriesInfo">DOI 10.17487/RFC5996</span>, <time datetime="2010-09" class="refDate">September 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5996">https://www.rfc-editor.org/info/rfc5996</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2827">[RFC2827]</dt>
        <dd>
<span class="refAuthor">Ferguson, P.</span> and <span class="refAuthor">D. Senie</span>, <span class="refTitle">"Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing"</span>, <span class="seriesInfo">BCP 38</span>, <span class="seriesInfo">RFC 2827</span>, <span class="seriesInfo">DOI 10.17487/RFC2827</span>, <time datetime="2000-05" class="refDate">May 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2827">https://www.rfc-editor.org/info/rfc2827</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1624">[RFC1624]</dt>
        <dd>
<span class="refAuthor">Rijsinghani, A., Ed.</span>, <span class="refTitle">"Computation of the Internet Checksum via Incremental Update"</span>, <span class="seriesInfo">RFC 1624</span>, <span class="seriesInfo">DOI 10.17487/RFC1624</span>, <time datetime="1994-05" class="refDate">May 1994</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1624">https://www.rfc-editor.org/info/rfc1624</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5508">[RFC5508]</dt>
        <dd>
<span class="refAuthor">Srisuresh, P.</span>, <span class="refAuthor">Ford, B.</span>, <span class="refAuthor">Sivakumar, S.</span>, and <span class="refAuthor">S. Guha</span>, <span class="refTitle">"NAT Behavioral Requirements for ICMP"</span>, <span class="seriesInfo">BCP 148</span>, <span class="seriesInfo">RFC 5508</span>, <span class="seriesInfo">DOI 10.17487/RFC5508</span>, <time datetime="2009-04" class="refDate">April 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5508">https://www.rfc-editor.org/info/rfc5508</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6204">[RFC6204]</dt>
        <dd>
<span class="refAuthor">Singh, H.</span>, <span class="refAuthor">Beebee, W.</span>, <span class="refAuthor">Donley, C.</span>, <span class="refAuthor">Stark, B.</span>, and <span class="refAuthor">O. Troan, Ed.</span>, <span class="refTitle">"Basic Requirements for IPv6 Customer Edge Routers"</span>, <span class="seriesInfo">RFC 6204</span>, <span class="seriesInfo">DOI 10.17487/RFC6204</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6204">https://www.rfc-editor.org/info/rfc6204</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6724">[RFC6724]</dt>
        <dd>
<span class="refAuthor">Thaler, D., Ed.</span>, <span class="refAuthor">Draves, R.</span>, <span class="refAuthor">Matsumoto, A.</span>, and <span class="refAuthor">T. Chown</span>, <span class="refTitle">"Default Address Selection for Internet Protocol Version 6 (IPv6)"</span>, <span class="seriesInfo">RFC 6724</span>, <span class="seriesInfo">DOI 10.17487/RFC6724</span>, <time datetime="2012-09" class="refDate">September 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6724">https://www.rfc-editor.org/info/rfc6724</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5389">[RFC5389]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span>, <span class="refAuthor">Mahy, R.</span>, <span class="refAuthor">Matthews, P.</span>, and <span class="refAuthor">D. Wing</span>, <span class="refTitle">"Session Traversal Utilities for NAT (STUN)"</span>, <span class="seriesInfo">RFC 5389</span>, <span class="seriesInfo">DOI 10.17487/RFC5389</span>, <time datetime="2008-10" class="refDate">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5389">https://www.rfc-editor.org/info/rfc5389</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5766">[RFC5766]</dt>
        <dd>
<span class="refAuthor">Mahy, R.</span>, <span class="refAuthor">Matthews, P.</span>, and <span class="refAuthor">J. Rosenberg</span>, <span class="refTitle">"Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)"</span>, <span class="seriesInfo">RFC 5766</span>, <span class="seriesInfo">DOI 10.17487/RFC5766</span>, <time datetime="2010-04" class="refDate">April 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5766">https://www.rfc-editor.org/info/rfc5766</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5245">[RFC5245]</dt>
        <dd>
<span class="refAuthor">Rosenberg, J.</span>, <span class="refTitle">"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols"</span>, <span class="seriesInfo">RFC 5245</span>, <span class="seriesInfo">DOI 10.17487/RFC5245</span>, <time datetime="2010-04" class="refDate">April 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5245">https://www.rfc-editor.org/info/rfc5245</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6144">[RFC6144]</dt>
        <dd>
<span class="refAuthor">Baker, F.</span>, <span class="refAuthor">Li, X.</span>, <span class="refAuthor">Bao, C.</span>, and <span class="refAuthor">K. Yin</span>, <span class="refTitle">"Framework for IPv4/IPv6 Translation"</span>, <span class="seriesInfo">RFC 6144</span>, <span class="seriesInfo">DOI 10.17487/RFC6144</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6144">https://www.rfc-editor.org/info/rfc6144</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6147">[RFC6147]</dt>
        <dd>
<span class="refAuthor">Bagnulo, M.</span>, <span class="refAuthor">Sullivan, A.</span>, <span class="refAuthor">Matthews, P.</span>, and <span class="refAuthor">I. van Beijnum</span>, <span class="refTitle">"DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers"</span>, <span class="seriesInfo">RFC 6147</span>, <span class="seriesInfo">DOI 10.17487/RFC6147</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6147">https://www.rfc-editor.org/info/rfc6147</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6145">[RFC6145]</dt>
        <dd>
<span class="refAuthor">Li, X.</span>, <span class="refAuthor">Bao, C.</span>, and <span class="refAuthor">F. Baker</span>, <span class="refTitle">"IP/ICMP Translation Algorithm"</span>, <span class="seriesInfo">RFC 6145</span>, <span class="seriesInfo">DOI 10.17487/RFC6145</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6145">https://www.rfc-editor.org/info/rfc6145</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6146">[RFC6146]</dt>
        <dd>
<span class="refAuthor">Bagnulo, M.</span>, <span class="refAuthor">Matthews, P.</span>, and <span class="refAuthor">I. van Beijnum</span>, <span class="refTitle">"Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers"</span>, <span class="seriesInfo">RFC 6146</span>, <span class="seriesInfo">DOI 10.17487/RFC6146</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6146">https://www.rfc-editor.org/info/rfc6146</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6052">[RFC6052]</dt>
        <dd>
<span class="refAuthor">Bao, C.</span>, <span class="refAuthor">Huitema, C.</span>, <span class="refAuthor">Bagnulo, M.</span>, <span class="refAuthor">Boucadair, M.</span>, and <span class="refAuthor">X. Li</span>, <span class="refTitle">"IPv6 Addressing of IPv4/IPv6 Translators"</span>, <span class="seriesInfo">RFC 6052</span>, <span class="seriesInfo">DOI 10.17487/RFC6052</span>, <time datetime="2010-10" class="refDate">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6052">https://www.rfc-editor.org/info/rfc6052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1918">[RFC1918]</dt>
      <dd>
<span class="refAuthor">Rekhter, Y.</span>, <span class="refAuthor">Moskowitz, B.</span>, <span class="refAuthor">Karrenberg, D.</span>, <span class="refAuthor">de Groot, G. J.</span>, and <span class="refAuthor">E. Lear</span>, <span class="refTitle">"Address Allocation for Private Internets"</span>, <span class="seriesInfo">BCP 5</span>, <span class="seriesInfo">RFC 1918</span>, <span class="seriesInfo">DOI 10.17487/RFC1918</span>, <time datetime="1996-02" class="refDate">February 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1918">https://www.rfc-editor.org/info/rfc1918</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="why-gse">
<section id="appendix-A">
      <h2 id="name-why-gse">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-why-gse" class="section-name selfRef">Why GSE?</a>
      </h2>
<p id="appendix-A-1">For the purpose of this discussion, let us oversimplify the
   Internet's structure by distinguishing between two broad classes of
   networks: transit and edge.  A "transit network", in this context, is
   a network that provides connectivity services to other networks.  Its
   Autonomous System (AS) number may show up in a non-final position in
   BGP AS paths, or in the case of mobile and residential broadband
   networks, it may offer network services to smaller networks that
   cannot justify RIR membership.  An "edge network", in contrast, is
   any network that is not a transit network; it is the ultimate
   customer, and while it provides internal connectivity for its own
   use, it is a consumer of transit services in other respects.  In
   terms of routing, a network in the transit domain generally needs
   some way to make choices about how it routes to other networks; an
   edge network is generally quite satisfied with a simple default
   route.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">The <span>[<a href="#GSE" class="cite xref">GSE</a>]</span> proposal, and as a result this proposal (which is similar
   to GSE in most respects and inspired by it), responds directly to
   current concerns in the RIR communities.  Edge networks are used to
   an environment in IPv4 in which their addressing is disjoint from
   that of their upstream transit networks; it is either provider
   independent, or a network prefix translator makes their external
   address distinct from their internal address, and they like the
   distinction.  In IPv6, there is a mantra that edge network addresses
   should be derived from their upstream, and if they have multiple
   upstreams, edge networks are expected to design their networks to use
   all of those prefixes equivalently.  They see this as unnecessary and
   unwanted operational complexity and, as a result, are pushing very
   hard in the RIR communities for provider-independent addressing.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">Widespread use of provider-independent addressing has a natural and
   perhaps unavoidable side effect that is likely to be very expensive
   in the long term.  With widespread PI addressing, the routing table
   will enumerate the networks at the edge of the transit domain, the
   edge networks, rather than enumerate the transit domain.  Per the BGP
   Update Report of 17 December 2010, there are currently over 36,000
   Autonomous Systems being advertised in BGP, of which over 15,000
   advertise only one prefix.  There are in the neighborhood of 5000 ASs
   that show up in a non-final position in AS paths, and perhaps another
   5000 networks whose AS numbers are terminal in more than one AS path.
   In other words, we have prefixes for some 36,000 transit and edge
   networks in the route table now, many of which arguably need an
   Autonomous System number only for multihoming.  The vast majority of
   networks (2/3) having the tools necessary to multihome are not visibly
   doing so and would be well served by any solution that gives
   them address independence without the overhead of RIR membership and
   BGP routing.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">Current growth estimates suggest that we could easily see that be on
   the order of 10,000,000 within fifteen years.  Tens of thousands of
   entries in the route table are very survivable; while our protocols
   and computers will likely do quite well with tens of millions of
   routes, the heat produced and power consumed by those routers, and
   the inevitable impact on the cost of those routers, is not a good
   outcome.  To avoid having a massive and unscalable route table, we
   need to find a way that is politically acceptable and returns us to
   enumerating the transit domain, not the edge.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">There have been a number of proposals.  As described, Shim6 moves the
   complexity to the edge, and the edge is rebelling.  Geographic
   addressing in essence forces ISPs to "own" geographic territory from
   a routing perspective, as otherwise there is no clue in the address
   as to what network a datagram should be delivered to in order to
   reach it.  Metropolitan Addressing can imply regulatory authority
   and, even if it is implemented using internet exchange consortia,
   visits a great deal of complexity on the transit networks that
   directly serve the edge.  The one that is likely to be most
   acceptable is any proposal that enables an edge network to be
   operationally independent of its upstreams, with no obligation to
   renumber when it adds, drops, or changes ISPs, and with no additional
   burden placed either on the ISP or the edge network as a result.
   From an application perspective, an additional operational
   requirement in the words of the Roadmap for the Smart Grid <span>[<a href="#NIST" class="cite xref">NIST</a>]</span> is
   that
~~~~~~~~~~
      "...the network should provide the capability to enable an
      application in a particular domain to communicate with an
      application in any other domain over the information network, with
      proper management control as to who and where applications can be
      inter-connected."
~~~~~~~~~~
   In other words, the structure of the network should allow for and
   enable appropriate access control, but the structure of the network
   should not inherently limit access.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">The GSE model, by statelessly translating the prefix between an edge
   network and its upstream transit network, accomplishes that with a
   minimum of fuss and bother.  Stated in the simplest terms, it enables
   the edge network to behave as if it has a provider-independent prefix
   from a multihoming and renumbering perspective without the overhead
   of RIR membership or maintenance of BGP connectivity, and it enables
   the transit networks to aggressively aggregate what are from their
   perspective provider-allocated customer prefixes, to maintain a
   rational-sized routing table.<a href="#appendix-A-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="verification-code">
<section id="appendix-B">
      <h2 id="name-verification-code">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-verification-code" class="section-name selfRef">Verification Code</a>
      </h2>
<p id="appendix-B-1">This non-normative appendix is presented as a proof of concept; it is
   in no sense optimized.  For example, one's complement arithmetic is
   implemented in portable subroutines, where operational
   implementations might use one's complement arithmetic instructions
   through a pragma; such implementations probably need to explicitly
   force 0xFFFF to 0x0000, as the instruction will not.  The original
   purpose of the code was to verify whether or not it was necessary to
   suppress 0xFFFF by overwriting with zero and whether predicted issues
   with subnet numbering were real.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">The point is to<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-3.1">
          <p id="appendix-B-3.1.1">demonstrate that if one or the other representation of zero is not
    used in the word in which the checksum is updated, the program
    maps inner and outer addresses in a manner that is,
    mathematically, 1:1 and onto (each inner address maps to a unique
    outer address, and that outer address maps back to exactly the
    same inner address), and<a href="#appendix-B-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.2">
          <p id="appendix-B-3.2.1">give guidance on the suppression of 0xFFFF checksums.<a href="#appendix-B-3.2.1" class="pilcrow">¶</a></p>
<p id="appendix-B-3.2.2">
In short, in one's complement arithmetic, x-x=0 but will take the
 negative representation of zero.  If 0xFFFF results are forced to the
 value 0x0000, as is recommended in <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span>, the word the checksum
 is adjusted in cannot be initially 0xFFFF, as on the return it will
 be forced to 0.  If 0xFFFF results are not forced to the value 0x0000
 as is recommended in <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span>, the word the checksum is adjusted in
 cannot be initially 0, as on the return it will be calculated as
 0+(~0) = 0xFFFF.  We chose to follow <span>[<a href="#RFC1071" class="cite xref">RFC1071</a>]</span>'s recommendations,
 which implies a requirement to not use 0xFFFF as a subnet number in
 networks with a /48 external prefix.<a href="#appendix-B-3.2.2" class="pilcrow">¶</a></p>
</li>
      </ul>
<div class="alignLeft art-text artwork" id="appendix-B-4">
<pre>
  /*
   * Copyright (c) 2011 IETF Trust and the persons identified as
   * authors of the code.  All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   *
   * - Redistributions of source code must retain the above copyright
   *   notice, this list of conditions and the following disclaimer.
   *
   * - Redistributions in binary form must reproduce the above
   *   copyright notice, this list of conditions and the following
   *   disclaimer in the documentation and/or other materials provided
   *   with the distribution.
   *
   * - Neither the name of Internet Society, IETF or IETF Trust, nor
   *   the names of specific contributors, may be used to endorse or
   *   promote products derived from this software without specific
   *   prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND
   * CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
   * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
   * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
   * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
   * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
   * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
   * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
   * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   * POSSIBILITY OF SUCH DAMAGE.
   */
  #include "stdio.h"
  #include "assert.h"
  /*
   * program to verify the NPTv6 algorithm
   *
   * argument:
   *    Perform negative zero suppression: boolean
   *
   * method:
   *    We specify an internal and an external prefix.  The prefix
   *    length is presumed to be the common length of both and, for
   *    this, is a /48.  We perform the three algorithms specified.
   *    The "datagram" address is in effect the source address
   *    internal-&gt;external and the destination address
   *    external-&gt;internal.
   */
  unsigned short  inner_init[] = {
      0xFD01, 0x0203, 0x0405, 1, 2, 3, 4, 5};
  unsigned short  outer_init[] = {
      0x2001, 0x0db8, 0x0001, 1, 2, 3, 4, 5};
  unsigned short  inner[8];
  unsigned short  datagram[8];
  unsigned char   checksum[65536] = {0};

  unsigned short  outer[8];
  unsigned short  adjustment;
  unsigned short  suppress;
  /*
   * One's complement sum.
   * return number1 + number2
   */
  unsigned short
  add1(number1, number2)
      unsigned short  number1;
      unsigned short  number2;
  {
      unsigned int    result;

      result = number1;
      result += number2;
      if (suppress) {
          while (0xFFFF &lt;= result) {
              result = result + 1 - 0x10000;
          }
      } else {
          while (0xFFFF &lt; result) {
              result = result + 1 - 0x10000;
          }
      }
      return result;
  }

  /*
   * One's complement difference
   * return number1 - number2
   */
  unsigned short
  sub1(number1, number2)
      unsigned short  number1;
      unsigned short  number2;
  {
      return add1(number1, ~number2);
  }

  /*
   * return one's complement sum of an array of numbers
   */
  unsigned short
  sum1(numbers, count)
      unsigned short *numbers;
      int             count;
  {
      unsigned int    result;

      result = *numbers++;
      while (--count &gt; 0) {
          result += *numbers++;
      }

      if (suppress) {
          while (0xFFFF &lt;= result) {
              result = result + 1 - 0x10000;
          }
      } else {
          while (0xFFFF &lt; result) {
              result = result + 1 - 0x10000;
          }
      }
      return result;
  }

  /*
   * NPTv6 initialization: Section 3.1 assuming Section 3.4
   *
   * Create the /48, a source address in internal format, and a
   * source address in external format.  Calculate the adjustment
   * if one /48 is overwritten with the other.
   */
  void
  nptv6_initialization(subnet)
      unsigned short  subnet;
  {
      int             i;
      unsigned short  inner48;
      unsigned short  outer48;

      /* Initialize the internal and external prefixes. */
      for (i = 0; i &lt; 8; i++) {
          inner[i] = inner_init[i];
          outer[i] = outer_init[i];
      }
      inner[3] = subnet;
      outer[3] = subnet;
      /* Calculate the checksum adjustment. */
      inner48 = sum1(inner, 3);
      outer48 = sum1(outer, 3);
      adjustment = sub1(inner48, outer48);
  }

  /*
   * NPTv6 datagram from edge to transit: Section 3.2 assuming
   * Section 3.4
   *
   * Overwrite the prefix in the source address with the outer
   * prefix and adjust the checksum.
   */
  void
  nptv6_inner_to_outer()
  {
      int             i;

      /* Let's get the source address into the datagram. */
      for (i = 0; i &lt; 8; i++) {
          datagram[i] = inner[i];
      }

      /* Overwrite the prefix with the outer prefix. */
      for (i = 0; i &lt; 3; i++) {
          datagram[i] = outer[i];
      }

      /* Adjust the checksum. */
      datagram[3] = add1(datagram[3], adjustment);
  }

  /*
   * NPTv6 datagram from transit to edge: Section 3.3 assuming
   * Section 3.4
   *
   * Overwrite the prefix in the destination address with the
   * inner prefix and adjust the checksum.
   */
  void
  nptv6_outer_to_inner()
  {
      int             i;

      /* Overwrite the prefix with the outer prefix. */
      for (i = 0; i &lt; 3; i++) {
          datagram[i] = inner[i];
      }

      /* Adjust the checksum. */
      datagram[3] = sub1(datagram[3], adjustment);
  }

  /*
   * Main program
   */
  main(argc, argv)
      int             argc;
      char          **argv;
  {
      unsigned        subnet;
      int             i;

      if (argc &lt; 2) {
             fprintf(stderr, "usage: nptv6 supression\n");
             assert(0);
         }
         suppress = atoi(argv[1]);
         assert(suppress &lt;= 1);

         for (subnet = 0; subnet &lt; 0x10000; subnet++) {
             /* Section 3.1: initialize the system */
             nptv6_initialization(subnet);

             /* Section 3.2: take a datagram from inside to outside */
             nptv6_inner_to_outer();

             /* The resulting checksum value should be unique. */
             if (checksum[subnet]) {
                  printf("inner-&gt;outer duplicated checksum: "
                         "inner: %x:%x:%x:%x:%x:%x:%x:%x(%x) "
                         "calculated: %x:%x:%x:%x:%x:%x:%x:%x(%x)\n",
                         inner[0], inner[1], inner[2], inner[3],
                         inner[4], inner[5], inner[6], inner[7],
                         sum1(inner, 8), datagram[0], datagram[1],
                         datagram[2], datagram[3], datagram[4],
                         datagram[5], datagram[6], datagram[7],
                         sum1(datagram, 8));
          }

          checksum[subnet] = 1;

          /*
           * The resulting checksum should be the same as the inner
           * address's checksum.
           */
          if (sum1(datagram, 8) != sum1(inner, 8)) {
              printf("inner-&gt;outer incorrect: "
                     "inner: %x:%x:%x:%x:%x:%x:%x:%x(%x) "
                     "calculated: %x:%x:%x:%x:%x:%x:%x:%x(%x)\n",
                     inner[0], inner[1], inner[2], inner[3],
                     inner[4], inner[5], inner[6], inner[7],
                     sum1(inner, 8),
                     datagram[0], datagram[1], datagram[2], datagram[3],
                     datagram[4], datagram[5], datagram[6], datagram[7],
                     sum1(datagram, 8));
          }

          /* Section 3.3: take a datagram from outside to inside */
          nptv6_outer_to_inner();

          /*
           * The returning datagram should have the same checksum it
           * left with.
           */
          if (sum1(datagram, 8) != sum1(inner, 8)) {
              printf("outer-&gt;inner checksum incorrect: "
                     "calculated: %x:%x:%x:%x:%x:%x:%x:%x(%x) "
                     "inner: %x:%x:%x:%x:%x:%x:%x:%x(%x)\n",
                     datagram[0], datagram[1], datagram[2], datagram[3],
                     datagram[4], datagram[5], datagram[6], datagram[7],
                     sum1(datagram, 8), inner[0], inner[1], inner[2],
                     inner[3], inner[4], inner[5], inner[6], inner[7],
                     sum1(inner, 8));
          }

          /*
           * And every octet should calculate back to the same inner
           * value.
           */
          for (i = 0; i &lt; 8; i++) {
              if (inner[i] != datagram[i]) {
                  printf("outer-&gt;inner different: "
                         "calculated: %x:%x:%x:%x:%x:%x:%x:%x "
                         "inner: %x:%x:%x:%x:%x:%x:%x:%x\n",
                         datagram[0], datagram[1], datagram[2],
                         datagram[3], datagram[4], datagram[5],
                         datagram[6], datagram[7], inner[0], inner[1],
                         inner[2], inner[3], inner[4], inner[5],
                         inner[6], inner[7]);
                  break;
              }
          }
      }
  }

</pre><a href="#appendix-B-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Margaret Wasserman</span></div>
<div dir="auto" class="left"><span class="org">Painless Security</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mrw@painless-security.com" class="email">mrw@painless-security.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Fred Baker</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:fred@cisco.com" class="email">fred@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ole Troan</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:otroan@cisco.com" class="email">otroan@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nick Buraglio</span></div>
<div dir="auto" class="left"><span class="org">Energy Sciences Network</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:buraglio@forwardingplane.net" class="email">buraglio@forwardingplane.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
